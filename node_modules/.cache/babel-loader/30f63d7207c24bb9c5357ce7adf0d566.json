{"remainingRequest":"/Users/mehul/Meetuper/node_modules/babel-loader/lib/index.js!/Users/mehul/Meetuper/node_modules/eslint-loader/index.js??ref--13-0!/Users/mehul/Meetuper/src/store/modules/auth.js","dependencies":[{"path":"/Users/mehul/Meetuper/src/store/modules/auth.js","mtime":1555713385517},{"path":"/Users/mehul/Meetuper/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mehul/Meetuper/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mehul/Meetuper/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Promise from \"/Users/mehul/Meetuper/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport axios from 'axios';\nimport jwt from 'jsonwebtoken';\nimport axiosInstance from '@/services/axios';\nimport { rejectError } from '@/helpers';\n\nfunction checkTokenValidity(token) {\n  if (token) {\n    var decodedToken = jwt.decode(token);\n    return decodedToken && decodedToken.exp * 1000 > new Date().getTime();\n  }\n\n  return false;\n}\n\nexport default {\n  namespaced: true,\n  state: {\n    user: null,\n    isAuthResolved: false\n  },\n  getters: {\n    authUser: function authUser(state) {\n      return state.user || null;\n    },\n    isAuthenticated: function isAuthenticated(state) {\n      return !!state.user;\n    }\n  },\n  actions: {\n    loginWithEmailAndPassword: function loginWithEmailAndPassword(_ref, userData) {\n      var commit = _ref.commit;\n      return axios.post('/api/v1/users/login', userData).then(function (res) {\n        var user = res.data;\n        localStorage.setItem('meetuper-jwt', user.token);\n        commit('setAuthUser', user);\n      }).catch(function (err) {\n        return rejectError(err);\n      });\n    },\n    registerUser: function registerUser(context, userData) {\n      return axios.post('/api/v1/users/register', userData).catch(function (err) {\n        return rejectError(err);\n      });\n    },\n    logout: function logout(_ref2) {\n      var commit = _ref2.commit;\n      // For Session Authnetication !\n      // return axios.post('/api/v1/users/logout')\n      //   .then(() => {\n      //     commit('setAuthUser', null)\n      //     return true\n      //   })\n      //   .catch(err => {\n      //     return err\n      //   })\n      return new _Promise(function (resolve) {\n        localStorage.removeItem('meetuper-jwt');\n        commit('setAuthUser', null);\n        resolve(true);\n      });\n    },\n    getAuthUser: function getAuthUser(_ref3) {\n      var commit = _ref3.commit,\n          getters = _ref3.getters;\n      var authUser = getters['authUser'];\n      var token = localStorage.getItem('meetuper-jwt');\n      var isTokenValid = checkTokenValidity(token);\n\n      if (authUser && isTokenValid) {\n        return _Promise.resolve(authUser);\n      }\n\n      var config = {\n        headers: {\n          'Cache-Control': 'no-cache'\n        }\n      };\n      return axiosInstance.get('/api/v1/users/me', config).then(function (res) {\n        var user = res.data;\n        localStorage.setItem('meetuper-jwt', user.token);\n        commit('setAuthUser', user);\n        commit('setAuthState', true);\n        return user;\n      }).catch(function (err) {\n        commit('setAuthUser', null);\n        commit('setAuthState', true);\n        return err;\n      });\n    }\n  },\n  mutations: {\n    setAuthUser: function setAuthUser(state, user) {\n      return state.user = user;\n    },\n    setAuthState: function setAuthState(state, authState) {\n      return state.isAuthResolved = authState;\n    }\n  }\n};",{"version":3,"sources":["/Users/mehul/Meetuper/src/store/modules/auth.js"],"names":["axios","jwt","axiosInstance","rejectError","checkTokenValidity","token","decodedToken","decode","exp","Date","getTime","namespaced","state","user","isAuthResolved","getters","authUser","isAuthenticated","actions","loginWithEmailAndPassword","userData","commit","post","then","res","data","localStorage","setItem","catch","err","registerUser","context","logout","resolve","removeItem","getAuthUser","getItem","isTokenValid","config","headers","get","mutations","setAuthUser","setAuthState","authState"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport jwt from 'jsonwebtoken'\nimport axiosInstance from '@/services/axios'\nimport { rejectError } from '@/helpers'\n\nfunction checkTokenValidity(token) {\n    if (token) {\n        const decodedToken = jwt.decode(token)\n\n        return decodedToken && (decodedToken.exp * 1000) > new Date().getTime()\n    }\n\n    return false\n}\nexport default {\n    namespaced: true,\n    state: {\n        user: null,\n        isAuthResolved: false\n    },\n    getters: {\n        authUser(state) {\n            return state.user || null\n        },\n        isAuthenticated(state) {\n            return !!state.user\n        }\n    },\n    actions: {\n        loginWithEmailAndPassword({ commit }, userData) {\n            return axios.post('/api/v1/users/login', userData)\n                .then(res => {\n                    const user = res.data\n                    localStorage.setItem('meetuper-jwt', user.token)\n                    commit('setAuthUser', user)\n                })\n                .catch(err => rejectError(err))\n        },\n        registerUser(context, userData) {\n            return axios.post('/api/v1/users/register', userData)\n                .catch(err => rejectError(err))\n        },\n        logout({ commit }) {\n            // For Session Authnetication !\n            // return axios.post('/api/v1/users/logout')\n            //   .then(() => {\n            //     commit('setAuthUser', null)\n            //     return true\n            //   })\n            //   .catch(err => {\n            //     return err\n            //   })\n\n            return new Promise((resolve) => {\n                localStorage.removeItem('meetuper-jwt')\n                commit('setAuthUser', null)\n                resolve(true)\n            })\n        },\n        getAuthUser({ commit, getters }) {\n            const authUser = getters['authUser']\n            const token = localStorage.getItem('meetuper-jwt')\n            const isTokenValid = checkTokenValidity(token)\n\n            if (authUser && isTokenValid) { return Promise.resolve(authUser) }\n            const config = {\n                headers: {\n                    'Cache-Control': 'no-cache'\n                }\n            }\n\n            return axiosInstance.get('/api/v1/users/me', config)\n                .then((res) => {\n                    const user = res.data\n                    localStorage.setItem('meetuper-jwt', user.token)\n                    commit('setAuthUser', user)\n                    commit('setAuthState', true)\n                    return user\n                })\n                .catch(err => {\n                    commit('setAuthUser', null)\n                    commit('setAuthState', true)\n                    return err\n                })\n        }\n    },\n    mutations: {\n        setAuthUser(state, user) {\n            return state.user = user\n        },\n        setAuthState(state, authState) {\n            return state.isAuthResolved = authState\n        }\n    }\n}"]}]}
{"remainingRequest":"/Users/mehul/Meetuper/node_modules/babel-loader/lib/index.js!/Users/mehul/Meetuper/node_modules/eslint-loader/index.js??ref--13-0!/Users/mehul/Meetuper/src/store/modules/auth.js","dependencies":[{"path":"/Users/mehul/Meetuper/src/store/modules/auth.js","mtime":1555782489845},{"path":"/Users/mehul/Meetuper/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mehul/Meetuper/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mehul/Meetuper/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport _toConsumableArray from \"/Users/mehul/Meetuper/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _Promise from \"/Users/mehul/Meetuper/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport Vue from 'vue';\nimport axios from 'axios';\nimport jwt from 'jsonwebtoken';\nimport axiosInstance from '@/services/axios';\nimport { rejectError } from '@/helpers';\n\nfunction checkTokenValidity(token) {\n  if (token) {\n    var decodedToken = jwt.decode(token);\n    return decodedToken && decodedToken.exp * 1000 > new Date().getTime();\n  }\n\n  return false;\n}\n\nexport default {\n  namespaced: true,\n  state: {\n    user: null,\n    isAuthResolved: false\n  },\n  getters: {\n    authUser: function authUser(state) {\n      return state.user || null;\n    },\n    isAuthenticated: function isAuthenticated(state) {\n      return !!state.user;\n    },\n    isMeetupOwner: function isMeetupOwner(state) {\n      return function (meetupCreatorId) {\n        if (!state.user) return false;\n        return state.user._id === meetupCreatorId;\n      };\n    },\n    isMember: function isMember(state) {\n      return function (meetupId) {\n        return state.user && state.user['joinedMeetups'] && state.user['joinedMeetups'].includes(meetupId);\n      };\n    }\n  },\n  actions: {\n    loginWithEmailAndPassword: function loginWithEmailAndPassword(_ref, userData) {\n      var commit = _ref.commit;\n      return axios.post('/api/v1/users/login', userData).then(function (res) {\n        var user = res.data;\n        localStorage.setItem('meetuper-jwt', user.token);\n        commit('setAuthUser', user);\n      }).catch(function (err) {\n        return rejectError(err);\n      });\n    },\n    registerUser: function registerUser(context, userData) {\n      return axios.post('/api/v1/users/register', userData).catch(function (err) {\n        return rejectError(err);\n      });\n    },\n    logout: function logout(_ref2) {\n      var commit = _ref2.commit;\n      // For Session Authnetication !\n      // return axios.post('/api/v1/users/logout')\n      //   .then(() => {\n      //     commit('setAuthUser', null)\n      //     return true\n      //   })\n      //   .catch(err => {\n      //     return err\n      //   })\n      return new _Promise(function (resolve) {\n        localStorage.removeItem('meetuper-jwt');\n        commit('setAuthUser', null);\n        resolve(true);\n      });\n    },\n    getAuthUser: function getAuthUser(_ref3) {\n      var commit = _ref3.commit,\n          getters = _ref3.getters;\n      var authUser = getters['authUser'];\n      var token = localStorage.getItem('meetuper-jwt');\n      var isTokenValid = checkTokenValidity(token);\n\n      if (authUser && isTokenValid) {\n        return _Promise.resolve(authUser);\n      }\n\n      var config = {\n        headers: {\n          'Cache-Control': 'no-cache'\n        }\n      };\n      return axiosInstance.get('/api/v1/users/me', config).then(function (res) {\n        var user = res.data;\n        localStorage.setItem('meetuper-jwt', user.token);\n        commit('setAuthUser', user);\n        commit('setAuthState', true);\n        return user;\n      }).catch(function (err) {\n        commit('setAuthUser', null);\n        commit('setAuthState', true);\n        return err;\n      });\n    },\n    addMeetupToAuthUser: function addMeetupToAuthUser(_ref4, meetupId) {\n      var commit = _ref4.commit,\n          state = _ref4.state;\n      var userMeetups = [].concat(_toConsumableArray(state.user['joinedMeetups']), [meetupId]);\n      commit('setMeetupsToAuthUser', userMeetups);\n    },\n    removeMeetupFromAuthUser: function removeMeetupFromAuthUser(_ref5, meetupId) {\n      var commit = _ref5.commit,\n          state = _ref5.state;\n\n      var userMeetupsIds = _toConsumableArray(state.user['joinedMeetups']);\n\n      var index = userMeetupsIds.findIndex(function (userMeetupId) {\n        return userMeetupId === meetupId;\n      });\n      userMeetupsIds.splice(index, 1);\n      commit('setMeetupsToAuthUser', userMeetupsIds);\n    }\n  },\n  mutations: {\n    setAuthUser: function setAuthUser(state, user) {\n      return state.user = user;\n    },\n    setAuthState: function setAuthState(state, authState) {\n      return state.isAuthResolved = authState;\n    },\n    setMeetupsToAuthUser: function setMeetupsToAuthUser(state, meetups) {\n      return Vue.set(state.user, 'joinedMeetups', meetups);\n    }\n  }\n};",{"version":3,"sources":["/Users/mehul/Meetuper/src/store/modules/auth.js"],"names":["Vue","axios","jwt","axiosInstance","rejectError","checkTokenValidity","token","decodedToken","decode","exp","Date","getTime","namespaced","state","user","isAuthResolved","getters","authUser","isAuthenticated","isMeetupOwner","meetupCreatorId","_id","isMember","meetupId","includes","actions","loginWithEmailAndPassword","userData","commit","post","then","res","data","localStorage","setItem","catch","err","registerUser","context","logout","resolve","removeItem","getAuthUser","getItem","isTokenValid","config","headers","get","addMeetupToAuthUser","userMeetups","removeMeetupFromAuthUser","userMeetupsIds","index","findIndex","userMeetupId","splice","mutations","setAuthUser","setAuthState","authState","setMeetupsToAuthUser","meetups","set"],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport axios from 'axios'\nimport jwt from 'jsonwebtoken'\nimport axiosInstance from '@/services/axios'\nimport { rejectError } from '@/helpers'\n\nfunction checkTokenValidity(token) {\n    if (token) {\n        const decodedToken = jwt.decode(token)\n\n        return decodedToken && (decodedToken.exp * 1000) > new Date().getTime()\n    }\n    return false\n}\nexport default {\n    namespaced: true,\n    state: {\n        user: null,\n        isAuthResolved: false\n    },\n    getters: {\n        authUser(state) {\n            return state.user || null\n        },\n        isAuthenticated(state) {\n            return !!state.user\n        },\n        isMeetupOwner: (state) => (meetupCreatorId) => {\n            if (!state.user) return false\n            return state.user._id === meetupCreatorId\n        },\n        isMember: (state) => (meetupId) => {\n            return state.user &&\n                state.user['joinedMeetups'] &&\n                state.user['joinedMeetups'].includes(meetupId)\n        }\n    },\n    actions: {\n        loginWithEmailAndPassword({ commit }, userData) {\n            return axios.post('/api/v1/users/login', userData)\n                .then(res => {\n                    const user = res.data\n                    localStorage.setItem('meetuper-jwt', user.token)\n                    commit('setAuthUser', user)\n                })\n                .catch(err => rejectError(err))\n        },\n        registerUser(context, userData) {\n            return axios.post('/api/v1/users/register', userData)\n                .catch(err => rejectError(err))\n        },\n        logout({ commit }) {\n            // For Session Authnetication !\n            // return axios.post('/api/v1/users/logout')\n            //   .then(() => {\n            //     commit('setAuthUser', null)\n            //     return true\n            //   })\n            //   .catch(err => {\n            //     return err\n            //   })\n\n            return new Promise((resolve) => {\n                localStorage.removeItem('meetuper-jwt')\n                commit('setAuthUser', null)\n                resolve(true)\n            })\n        },\n        getAuthUser({ commit, getters }) {\n            const authUser = getters['authUser']\n            const token = localStorage.getItem('meetuper-jwt')\n            const isTokenValid = checkTokenValidity(token)\n\n            if (authUser && isTokenValid) { return Promise.resolve(authUser) }\n            const config = {\n                headers: {\n                    'Cache-Control': 'no-cache'\n                }\n            }\n\n            return axiosInstance.get('/api/v1/users/me', config)\n                .then((res) => {\n                    const user = res.data\n                    localStorage.setItem('meetuper-jwt', user.token)\n                    commit('setAuthUser', user)\n                    commit('setAuthState', true)\n                    return user\n                })\n                .catch(err => {\n                    commit('setAuthUser', null)\n                    commit('setAuthState', true)\n                    return err\n                })\n        },\n        addMeetupToAuthUser({ commit, state }, meetupId) {\n            const userMeetups = [...state.user['joinedMeetups'], meetupId]\n            commit('setMeetupsToAuthUser', userMeetups)\n        },\n        removeMeetupFromAuthUser({ commit, state }, meetupId) {\n            const userMeetupsIds = [...state.user['joinedMeetups']]\n            const index = userMeetupsIds.findIndex(userMeetupId => userMeetupId === meetupId)\n\n            userMeetupsIds.splice(index, 1)\n            commit('setMeetupsToAuthUser', userMeetupsIds)\n        }\n    },\n    mutations: {\n        setAuthUser(state, user) {\n            return state.user = user\n        },\n        setAuthState(state, authState) {\n            return state.isAuthResolved = authState\n        },\n        setMeetupsToAuthUser(state, meetups) {\n            return Vue.set(state.user, 'joinedMeetups', meetups)\n        }\n    }\n}"]}]}